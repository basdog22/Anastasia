ajaxhtml = '';
function loadajax(){
    jQuery.get(lara.cms.url+'/backend/assets/load/misc',function(response){
        ajaxhtml = response;
    })
};
tinymce.PluginManager.add('loadfile', function(editor, url) {
    // Add a button that opens a window
    loadajax();
    editor.addButton('loadfile', {
//        text: 'Load file',
        image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EDg8VHWUMGFkAAAFqSURBVDjLnZGxilNREIa//3gtYmMnlhoQbGwt1ubCibmmiGAhWwkLRljwFbbQwgcQRH0AC/sEBDmDIY0+gNUWkk622gVJocm5Y5NAvO4as38583/zzzDiP1SWJePxmBhjATyRdM/d70g6CJvgwWCwgl9Kmkt6DdwHXqWU3mrTgBjjbUmfgEvLkrv7FzPbAbiwAd6TNAIKQIADms/nN9rtdp5OpxT/gPclvVlBy7Lc/fFkMvm58p16QqfTuevuHyWtw+7uh2Z2c92rRio556tFUXxvJOPuhBBu1XX91cw4c4MY4zfgmqQ/YEnvUkqPmv7QgA8kXV+HAZf0q67rvbIs/zpXAFVVkXO+DJw0+u7uAnZardbn0Wh0+oBl+ntJu43+D3ffNbMPZ31L/X6f2Wx2JYRwBFhKqcMWCsPhkBDCi+W+D7vd7jY8RVVVFxeLxQB4ZmbHbKmQc94HTszsOedQcPenwINer3cent9TV5GEeOH6mgAAAABJRU5ErkJggg==',
        icon: true,
        onclick: function() {
            // Open window
            editor.windowManager.open({
                title: 'Load file in editor',

                body: [{
                    type: 'container',
                    html: ajaxhtml
                }],

                buttons: [{
                    text: 'Close',
                    onclick: 'close'
                },{
                    text: 'Load Selected',
                    onclick: function(e){

                        var selected = jQuery("#file option:selected").val();
                        jQuery.get(lara.cms.url+'/backend/assets/read/misc/'+selected,function(response){
                            editor.insertContent(response);
                            editor.windowManager.close();
                        });
                    }
                }]
            });
        }
    });

    // Adds a menu item to the tools menu
    editor.addMenuItem('loadfile', {
        text: 'Load file',
        context: 'tools',
        image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EDg8VHWUMGFkAAAFqSURBVDjLnZGxilNREIa//3gtYmMnlhoQbGwt1ubCibmmiGAhWwkLRljwFbbQwgcQRH0AC/sEBDmDIY0+gNUWkk622gVJocm5Y5NAvO4as38583/zzzDiP1SWJePxmBhjATyRdM/d70g6CJvgwWCwgl9Kmkt6DdwHXqWU3mrTgBjjbUmfgEvLkrv7FzPbAbiwAd6TNAIKQIADms/nN9rtdp5OpxT/gPclvVlBy7Lc/fFkMvm58p16QqfTuevuHyWtw+7uh2Z2c92rRio556tFUXxvJOPuhBBu1XX91cw4c4MY4zfgmqQ/YEnvUkqPmv7QgA8kXV+HAZf0q67rvbIs/zpXAFVVkXO+DJw0+u7uAnZardbn0Wh0+oBl+ntJu43+D3ffNbMPZ31L/X6f2Wx2JYRwBFhKqcMWCsPhkBDCi+W+D7vd7jY8RVVVFxeLxQB4ZmbHbKmQc94HTszsOedQcPenwINer3cent9TV5GEeOH6mgAAAABJRU5ErkJggg==',
        icon: true,
        onclick: function() {
            // Open window
            editor.windowManager.open({
                title: 'Load file in editor',

                body: [{
                    type: 'container',
                    html: ajaxhtml
                }],

                buttons: [{
                    text: 'Close',
                    onclick: 'close'
                },{
                    text: 'Load Selected',
                    onclick: function(e){

                        var selected = jQuery("#file option:selected").val();
                        jQuery.get(lara.cms.url+'/backend/assets/read/misc/'+selected,function(response){
                            editor.insertContent(response);
                            editor.windowManager.close();
                        });
                    }
                }]
            });
        }
    });
});